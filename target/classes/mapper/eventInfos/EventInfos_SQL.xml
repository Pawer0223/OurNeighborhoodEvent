<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="eventInfos">

	<resultMap id="eventDetail" type="first.actions.model.EventInfos">
		<result property="eventSeq" column="EVENT_SEQ" />
		<result property="ptnNm" column="PTN_NM" />
		<result property="eventNm" column="EVENT_NM" />
		<result property="eventDesc" column="EVENT_DESC" />
		<result property="productPic" column="PRODUCT_PIC" />
		<result property="originPrice" column="ORIGIN_PRICE" />
		<result property="eventPrice" column="EVENT_PRICE" />
	</resultMap>

	<select id="selectLatestEvents" resultType="hashmap">
		<![CDATA[	  
		SELECT
		EVENT_SEQ,PTN_CD,PTN_NM,EVENT_NM,PRODUCT_PIC,ORIGIN_PRICE,EVENT_PRICE,AMOUNT,NEIGHBOR,DELIVERY_YN
		FROM EVENT_INFOS
		WHERE EVENT_STATUS ='WORK'
		ORDER BY EVENT_SEQ DESC
		]]>
	</select>
	
	<select id="eventDetailInfo" parameterType="String" resultMap="eventDetail">
		<![CDATA[	  
		SELECT EVENT_SEQ,PTN_NM,EVENT_NM,EVENT_DESC,PRODUCT_PIC,ORIGIN_PRICE,EVENT_PRICE
		FROM EVENT_INFOS
		WHERE PTN_CD = #{ ptnCd }
		]]>
	</select>
	
	<select id="getMaxEventSeq" resultType="String">
		<![CDATA[	  
		SELECT 'E'||LPAD(NVL(MAX(SUBSTR(EVENT_SEQ,2)),0)+1,6,'0') 
		FROM EVENT_INFOS
		]]>
	</select>
	
	<insert id="registEventInfos" parameterType="first.actions.model.EventInfos">
		<![CDATA[
		INSERT INTO EVENT_INFOS 
		VALUES ( #{ eventSeq }
			    ,#{ ptnCd } 
			   	,#{ ptnNm }
			   	,#{ eventNm }
			   	,#{ eventDesc }
			   	,#{ product }
			   	,#{ productPic }
			   	,#{ originPrice }
			   	,#{ eventPrice }
			   	,#{ amount }
			   	,'WORK'
			   	,#{ neighbor }
			   	,#{ deliveryYn }
			   	,SYSDATE
			   	,'' 
			   	)
		]]>
	</insert>
	
	<select id="getPtnCd" parameterType="String" resultType="String">
		<![CDATA[	  
		SELECT PTN_CD
		FROM EVENT_INFOS
		WHERE EVENT_SEQ = #{ eventSeq }
		]]>
	</select>

</mapper>


